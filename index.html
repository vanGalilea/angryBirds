<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
  <title>Drunken Birds</title>
	<script type="text/javascript" src="js/phaser.min.js"></script>
	<link rel="stylesheet" type="text/css" href="styles.css">

</head>
<body>
	<script type="text/javascript">
		var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });

		function preload() {
			game.load.image('background', 'assets/background.png');
			game.load.image('ground', 'assets/platform.png');
			game.load.image('beer', 'assets/beerbottle.png');
			game.load.image('bird', 'assets/angrybird.png');
			game.load.spritesheet('cannon', 'assets/cannonRight.png', 100, 100);
		}

		var cursors;
		var bird;
		var beers;

		var cannon;
		var anim;
		var ground;

		var score = 0;
		var scoreText;

		function create() {
			game.physics.startSystem(Phaser.Physics.P2JS);
			game.physics.p2.gravity.y = 300;
			game.physics.p2.restitution = 1.0;

			game.add.sprite(0, 0, 'background');

			beers = game.add.physicsGroup(Phaser.Physics.P2JS);

			for (var i = 0; i < 10; i++) {
				var beer;
				if (i < 4) beer = beers.create(game.world.width-150 - i * 30, game.world.height - 130, 'beer');
				if (i > 3 && i < 7) beer = beers.create(game.world.width-165 - (i - 4) * 30, game.world.height - 230, 'beer');
				if (i > 6 && i < 9) beer = beers.create(game.world.width-180 - (i - 7) * 30, game.world.height - 330, 'beer');
				if (i > 8)	beer = beers.create(game.world.width-195, game.world.height - 430, 'beer');

				game.physics.p2.enable(beer);
				beer.body.setRectangle(20, 80);
				beer.body.collideWorldBounds = true;
			}

			ground = game.add.sprite(415, game.world.height - 45, 'ground');
			ground.scale.setTo(1.06, 1);
			game.physics.p2.enable(ground);
			ground.body.static = true;

			bird = game.add.sprite(100, game.world.height - 150, 'bird');
			game.physics.p2.enable(bird);
			bird.body.setCircle(50);
			bird.body.collideWorldBounds = true;

			cannon = game.add.sprite(50, game.world.height - 200, 'cannon', 0);
	    cannon.scale.set(2);
	    cannon.smoothed = false;
	    anim = cannon.animations.add('shoot');

	    // anim.onStart.add(animationStarted, this);
	    // anim.onLoop.add(animationLooped, this);
	    // anim.onComplete.add(animationStopped, this);

			scoreText = game.add.text(16, 16, 'score: 0', { fontSize: '32px', fill: '#000' });

			cursors = game.input.keyboard.createCursorKeys();
		}

		function update() {
	    if (cursors.right.isDown){
				anim.play(10, true);
				bird.body.moveRight(game.rnd.integerInRange(100, 400));
				bird.body.moveUp(game.rnd.integerInRange(100, 400));
				anim.play(10, false);
			}


		}

	</script>

</body>
</html>
